<script>
    document.addEventListener('DOMContentLoaded', function() {
        var sidenav = document.querySelectorAll('.sidenav');
        M.Sidenav.init(sidenav);
        var modal = document.querySelectorAll('.modal');
        M.Modal.init(modal);
        var dropdown = document.querySelectorAll('.dropdown-trigger');
        M.Dropdown.init(dropdown, {alignment: "right", constrainWidth: false});
        var textarea = document.querySelectorAll('.textarea');
        M.CharacterCounter.init(textarea)
    });

    function cleaningJs() {
        M.toast({html: "Purge en cours"});
        google.script.run.withSuccessHandler(reloadNav).withFailureHandler(failNav).cleaning();
    }

    function cancelMatchJs() {
        M.toast({html: "Annulation en cours"});
        google.script.run.withSuccessHandler(reloadNav).withFailureHandler(failNav).cancelMatchAndSendMail(false);
    }

    function switchModeJs() {
        M.toast({html: "Bascule en cours"});
        google.script.run.withSuccessHandler(reloadNav).withFailureHandler(failNav).switchMode();
    }

    function sendRecordsLastMontJs() {
        M.toast({html: "Envoi en cours"});
        google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendLastMonthResultMail();
    }

    function recalculateStatsJs() {
        M.toast({ html: "Recalcul des statistiques en cours" });
        google.script.run.withSuccessHandler(successStats).withFailureHandler(failNav).initStats();
    }

    function sendMailsTestJs() {
        M.toast({ html: "Envoi des mails en cours" });
        google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).testMails();
    }

    function reloadNav() {
        google.script.run.withSuccessHandler(reloadNavWithUrl).getUrl();
        function reloadNavWithUrl(url) {
            google.script.url.getLocation(function (location) {
                window.top.location.href=url+"?page="+String(location.parameter.page)+"&mail="+String(location.parameter.mail)+"&key="+String(location.parameter.key);
            });
        }
    }

    function envoyerMessageJs() {
        if(document.getElementById("message").value) {
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).envoyerMessage({
                filtreEtatJoueur: document.querySelector('input[name="filtreEtatJoueur"]:checked').value,
                filtrePrio: document.querySelector('input[name="filtrePrio"]:checked').value,
                message: document.getElementById("message").value.replace(/\n\r?/g, '<br />'),
                isAnAlert: document.getElementById("isAnAlert").checked
            });
            M.toast({html: "Message en cours d'envoi"});
        }
    }

    function successStats() {
        M.toast({ html: "Statistiques mise à jour" });
    }

    function successNav() {
        M.toast({html: "Mails envoyés"});
    }

    function failNav() {
        M.toast({html: "Erreur"});
    }

</script>

