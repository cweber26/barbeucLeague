<script>
    document.addEventListener('DOMContentLoaded', function() {
        var sidenav = document.querySelectorAll('.sidenav');
        M.Sidenav.init(sidenav);
        var modal = document.querySelectorAll('.modal');
        M.Modal.init(modal);
        var dropdown = document.querySelectorAll('.dropdown-trigger');
        M.Dropdown.init(dropdown, {alignment: "right", constrainWidth: false});
        var textarea = document.querySelectorAll('.textarea');
        M.CharacterCounter.init(textarea)
    });

    function cleaningJs() {
        if (window.confirm("Es tu sûr de vouloir purger toutes les inscriptions ?")) {
            M.toast({html: "Purge en cours"});
            google.script.run.withSuccessHandler(reloadNav).withFailureHandler(failNav).cleaning();
        }
    }

    function sendPrio1Js() {
        if (window.confirm("Es tu sûr de vouloir envoyer les inscriptions aux joueurs de la prio 1 ?")) {
            M.toast({html: "Envoi en cours"});
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendInscriptionMailForAPrioWithoutControl(1);
        }
    }

    function sendPrio2Js() {
        if (window.confirm("Es tu sûr de vouloir envoyer les inscriptions aux joueurs de la prio 2 ?")) {
            M.toast({html: "Envoi en cours"});
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendInscriptionMailForAPrioWithoutControl(2);
        }
    }

    function sendPrio3Js() {
        if (window.confirm("Es tu sûr de vouloir envoyer les inscriptions aux joueurs de la prio 3 ?")) {
            M.toast({html: "Envoi en cours"});
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendInscriptionMailForAPrioWithoutControl(3);
        }
    }

    function sendReminderJs() {
        if (window.confirm("Es tu sûr de vouloir envoyer les rappels aux joueurs ?")) {
            M.toast({html: "Envoi en cours"});
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendReminderMailWithoutControl();
        }
    }

    function sendConfirmationJs() {
        if (window.confirm("Es tu sûr de vouloir envoyer les confirmations aux joueurs ?")) {
            M.toast({html: "Envoi en cours"});
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendConfirmMailWithoutControl();
        }
    }

    function cancelMatchJs() {
        if (window.confirm("Es tu sûr de vouloir annuler le match ?")) {
            M.toast({html: "Annulation en cours"});
            google.script.run.withSuccessHandler(reloadNav).withFailureHandler(failNav).cancelMatchAndSendMail(false);
        }
    }

    function switchModeJs() {
        if (window.confirm("Es tu sûr de vouloir basculer le mode ?")) {
            google.script.run.withSuccessHandler(reloadNav).withFailureHandler(failNav).switchMode();
        }
    }

    function sendRecordsLastMontJs() {
        if (window.confirm("Es tu sûr de vouloir envoyer le mail des résultats du dernier mois ?")) {
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).sendLastMonthResultMail();
        }
    }

    function recalculateStatsJs() {
        if (window.confirm("Es tu sûr de vouloir recalculer les statistiques (série de victoire / défaite) pour tous les joueurs ?")) {
            M.toast({ html: "Recalcul des statistiques en cours " });
            google.script.run.withSuccessHandler(successStats).withFailureHandler(failNav).initStats();
        }
    }

    function sendMailsTestJs() {
        if (window.confirm("Es tu sûr de vouloir envoyer les mails de test ?")) {
            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).testMails();
        }
    }

    function reloadNav() {
        google.script.url.getLocation(function (location) {
            var parameter = location.parameter;
            window.top.location.href="https://script.google.com/macros/s/AKfycbw7SggSd_5zNsbmfZ3nUU_nr2cXfRYIgntGSLh2n3sNhOJyUDs/exec?page="+String(parameter.page)+"&mail="+String(parameter.mail)+"&key="+String(parameter.key);
        });
    }

    function envoyerMessageJs() {

        if(document.getElementById("message").value) {

            google.script.run.withSuccessHandler(successNav).withFailureHandler(failNav).envoyerMessage({
                filtreEtatJoueur: document.querySelector('input[name="filtreEtatJoueur"]:checked').value,
                filtrePrio: document.querySelector('input[name="filtrePrio"]:checked').value,
                message: document.getElementById("message").value.replace(/\n\r?/g, '<br />')
            });

            M.toast({html: "Message en cours d'envoi"});

        }

    }

    function successStats() {
        M.toast({ html: "Statistiques mise à jour" });
    }

    function successNav() {
        M.toast({html: "Mails envoyés"});
    }

    function failNav() {
        M.toast({html: "Erreur"});
    }

</script>

